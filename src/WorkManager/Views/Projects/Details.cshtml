@model WorkManager.Models.ProjectsViewModels.DetailsViewModel

@{
    ViewData["Title"] = Model.Title;
}

<h2>Details</h2>

<div>
    <div class="jumbotron">
        <h2>@Html.DisplayFor(model => model.Title)</h2>
        <h3 id="today-duration"></h3>
        <h6>@Html.DisplayFor(model => model.Description)</h6>
        <hr />
        <button class="btn btn-primary btn-lg" 
                href="#" 
                role="button"
                id="start-btn">Start</button>
        <button class="btn btn-primary btn-lg" 
                href="#" 
                role="button"
                id="stop-btn">Stop</button>
        <hr />
        <div id="calendar">

        </div>
    </div>
</div>
<div>
    <a asp-action="Index">Back to List</a>
</div>

@section scripts
{
    <script src="~/lib/moment/moment.js"></script>
    <script src="~/lib/moment-duration-format/lib/moment-duration-format.js"></script>

    <script>
        $('#start-btn').click(function () {
            $.get('@Url.Action("start", "timers", new { projectId = Model.Id })');
        });

        $('#stop-btn').click(function () {
            $.get('@Url.Action("stop", "timers", new { projectId = Model.Id })');
        });

        window.setInterval(updateTodayDuration, 1000);

        function updateTodayDuration()
        {
                $.get({
                    url: '@Url.Action("TodayStatistics", "Timers", new { projectId = Model.Id })',
                    success: function (data) {
                        $('#today-duration').html(moment.duration(data.duration).format("hh:mm:ss", { trim : false }));
                    }
                });
        }
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js" type="text/javascript"></script>
    <link href="//arshaw.com/js/fullcalendar-1.5.3/fullcalendar/fullcalendar.css" rel="stylesheet" />
    <script src="//arshaw.com/js/fullcalendar-1.5.3/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
    <link href="http://arshaw.com/js/fullcalendar-1.5.3/fullcalendar/fullcalendar.print.css" rel="stylesheet" />

    <script>
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            timeFormat: 'H(:mm)',
            events: function (start, end, callback) {
                $.get({
                    url: '@Url.Action("Statistics", "Timers", new { projectId = Model.Id })',
                    data: {
                        start: start,
                        end: end
                    },
                    success: function (result) {
                        var events = [];
                        result.forEach(function (val) {
                            events.push({
                                title: "",
                                start: val.started,
                                end: val.stopped,
                                allDay: false,
                            });
                        });
                        console.log(events);
                        callback(events);
                    }
                });
            }
        });
    </script>
}
